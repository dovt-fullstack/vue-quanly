import{d as F,r as y,u as G,v as j,a as J,x as L,o as W,b as l,e as i,z as B,w as a,q as T,y as C,g as p,h as o,j as I,f,l as d,i as Y,t as N,C as H,F as U,p as Q,k as Z}from"./index-64ce397b.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";const te=F({setup(){const e=y(G().user.roleClaimDetail);j();const m=J(),P="http://localhost:9000",w=JSON.parse(localStorage.getItem("token")),D=JSON.parse(localStorage.getItem("auth")).role,z=y(m.params.id),A=y([]),c=y(""),t=L({currentPage:1,pageSize:10,totalItems:0,totalPages:0}),v=y(!1),k=y(""),$=y(),V=[{title:"#",key:"index"},{title:"Tên sản phẩm",dataIndex:"producName",key:"producName"},{title:"Ảnh sản phẩm",dataIndex:"imageSp",key:"imageSp"},{title:"Số lượng",dataIndex:"quantity",key:"quantity"},{title:"Giá",key:"price"},{title:"Trạng thái",key:"status"},{title:"Tác vụ",key:D,fixed:"right"}],X=n=>{if(n===0)return"status-stopped";if(n===1)return"status-selling";if(n===2)return"status-locked"},R=n=>{if(n===0)return"Ngừng bán";if(n===1)return"Đang bán";if(n===2)return"Bị khóa"},q=n=>{$.value=n,v.value=!0},x=()=>{console.log($.value),console.log(k.value),k.value?(K($.value,k.value),v.value=!1,k.value=""):console.error("Lý do không được để trống")},h=(n,u,g="")=>{T.get(`${P}/api/v1/management/${z.value}/product/view`,{headers:{Authorization:`Bearer ${w}`},params:{page:n,size:u,keyword:g}}).then(b=>{const O=b.data;A.value=O.data,t.totalItems=O.pagination.totalItems,t.totalPages=O.pagination.totalPages}).catch(b=>{console.error(b)})},K=(n,u)=>{const g=new FormData;g.append("productId",n),g.append("banReason",u),T.post(`${P}/api/v1/admin/product/ban`,g,{headers:{Authorization:`Bearer ${w}`}}).then(b=>{C.success("Khóa thành công!"),h(t.currentPage,t.pageSize,c.value)}).catch(b=>{C.error("Khóa không thành công!"),console.error(b)})},r=n=>{const u=new FormData;u.append("productId",n),T.post(`${P}/api/v1/admin/product/open`,u,{headers:{Authorization:`Bearer ${w}`}}).then(g=>{C.success("Mở khóa thành công!"),h(t.currentPage,t.pageSize,c.value)}).catch(g=>{C.error("Mở khóa không thành công!"),console.error(g)})},S=n=>{T.get(`${P}/api/v1/management/${z.value}/product/delete?productId=${n}`,{headers:{Authorization:`Bearer ${w}`}}).then(u=>{C.success("Xóa thành công!"),h(t.currentPage,t.pageSize,c.value)}).catch(u=>{C.error("Xóa không thành công!"),console.error(u)})},s=(n,u)=>{t.currentPage=n,t.pageSize=u,h(n,u,c.value)},_=()=>{t.currentPage=1,h(t.currentPage,t.pageSize,c.value)};return W(()=>{h(t.currentPage,t.pageSize)}),{authStoreClaim:e,getStatusClass:X,getStatusText:R,users:A,columns:V,pageParam:t,storeId2:z,searchKeyword:c,onChange:s,onSearch:_,confirmRemove:S,role:D,confirmUnBan:r,confirmBan:K,handleBanConfirm:x,showBanModal:q,isBanModalVisible:v,banReason:k}}}),M=e=>(Q("data-v-4b16a2c5"),e=e(),Z(),e),ae={class:"row mb-3"},oe={class:"col-6"},ne={key:0,class:"col-6 d-flex justify-content-end"},se=M(()=>p("i",{class:"fa-solid fa-plus"},null,-1)),re={class:"row mb-3"},le={class:"col-12"},ie={class:"row"},ce={class:"col-12"},ue={key:0},de={key:1},pe=["src","alt"],me={key:3},he={key:4},_e=M(()=>p("i",{class:"fa-solid fa-pen-to-square"},null,-1)),ge=M(()=>p("i",{class:"fa-solid fa-trash-can"},null,-1)),fe=M(()=>p("p",{class:"me-2 text-danger"},"Khóa",-1)),ke=M(()=>p("p",{class:"me-2 text-green"},"Mở",-1)),ye={class:"col-12"};function ve(e,m,P,w,E,D){const z=l("a-breadcrumb-item"),A=l("a-breadcrumb"),c=l("router-link"),t=l("a-button"),v=l("a-input"),k=l("a-form-item"),$=l("a-form"),V=l("a-tag"),X=l("a-space"),R=l("a-popconfirm"),q=l("a-modal"),x=l("a-table"),h=l("a-pagination"),K=l("a-card");return i(),B(K,{style:{width:"100%"}},{default:a(()=>[p("div",ae,[p("div",oe,[o(A,null,{default:a(()=>[o(z,null,{default:a(()=>[I("Sản phẩm của Cửa hàng")]),_:1})]),_:1})]),e.role==="MANAGER"?(i(),f("div",ne,[o(t,{class:"me-2"},{default:a(()=>[o(c,{to:{name:"product-type/them-moi",params:{id:e.storeId2}}},{default:a(()=>[I(" Loại sản phẩm ")]),_:1},8,["to"])]),_:1}),o(t,{type:"primary",title:"Thêm mới sản phẩm"},{default:a(()=>[o(c,{to:{name:"product/them-moi",params:{id:e.storeId2}}},{default:a(()=>[se]),_:1},8,["to"])]),_:1})])):d("",!0)]),p("div",re,[p("div",le,[o($,{onSubmit:Y(e.onSearch,["prevent"])},{default:a(()=>[o(k,null,{default:a(()=>[o(v,{placeholder:"Tìm kiếm sản phẩm",value:e.searchKeyword,"onUpdate:value":m[0]||(m[0]=r=>e.searchKeyword=r),onPressEnter:e.onSearch},null,8,["value","onPressEnter"])]),_:1}),o(t,{type:"primary",onClick:e.onSearch},{default:a(()=>[I("Tìm kiếm")]),_:1},8,["onClick"])]),_:1},8,["onSubmit"])])]),p("div",ie,[p("div",ce,[o(x,{dataSource:e.users,columns:e.columns,scroll:{x:576},pagination:!1},{bodyCell:a(({column:r,index:S,record:s})=>[r.key==="index"?(i(),f("span",ue,N(S+1),1)):d("",!0),r.key==="producName"?(i(),f("span",de,N(s.productName),1)):d("",!0),r.key==="imageSp"?(i(),f("img",{key:2,style:{width:"50px !important"},src:s.avatarProduct,alt:s.avatarProduct},null,8,pe)):d("",!0),r.key==="quantity"?(i(),f("span",me,N(s.quantity),1)):d("",!0),r.key==="price"?(i(),f("span",he,N(s.price),1)):d("",!0),r.key==="status"?(i(),B(V,{key:5,class:H(e.getStatusClass(s.status))},{default:a(()=>[I(N(e.getStatusText(s.status)),1)]),_:2},1032,["class"])):d("",!0),r.key==="MANAGER"&&e.authStoreClaim!==null?(i(),f(U,{key:6},[o(X,{warp:""},{default:a(()=>[s.status!==2?(i(),B(c,{key:0,to:{name:"admin-product-edit",params:{id:s.productId}}},{default:a(()=>[o(t,{type:"dashed",class:"me-2 text-primary",size:"small",title:"Sửa"},{default:a(()=>[_e]),_:1})]),_:2},1032,["to"])):d("",!0)]),_:2},1024),o(c,{to:{name:"admin-chi-tiet-san-pham",params:{id:s.productId}}},{default:a(()=>[o(t,{title:"Xem chi tiết",type:"dashed",size:"small",shape:"",class:"me-2 text-warning"},{default:a(()=>[I("Xem ")]),_:1})]),_:2},1032,["to"]),o(R,{title:"Dữ liệu sẽ không thể phục hồi, bạn muốn xóa bản ghi này?","ok-text":"Yes","cancel-text":"No",onConfirm:_=>e.confirmRemove(s.productId)},{default:a(()=>[o(t,{title:"Xóa",type:"dashed",size:"small",shape:"",danger:""},{default:a(()=>[ge]),_:1})]),_:2},1032,["onConfirm"])],64)):d("",!0),r.key==="ADMIN"&&e.authStoreClaim!==null?(i(),f(U,{key:7},[o(c,{to:{name:"admin-chi-tiet-san-pham",params:{id:s.productId}}},{default:a(()=>[o(t,{title:"Xem chi tiết",type:"dashed",size:"small",shape:"",class:"me-2 text-warning"},{default:a(()=>[I("Xem ")]),_:1})]),_:2},1032,["to"]),s.status!=2?(i(),B(t,{key:0,onClick:_=>e.showBanModal(s.productId),title:"Khóa sản phẩm",type:"dashed",size:"small",shape:"",danger:""},{default:a(()=>[fe]),_:2},1032,["onClick"])):d("",!0),s.status===2?(i(),B(R,{key:1,title:"Bạn có muốn mở khóa sản phẩm?","ok-text":"Yes","cancel-text":"No",onConfirm:_=>e.confirmUnBan(s.productId)},{default:a(()=>[o(t,{title:"Khóa sản phẩm",type:"dashed",size:"small",shape:""},{default:a(()=>[ke]),_:1})]),_:2},1032,["onConfirm"])):d("",!0),o(q,{visible:e.isBanModalVisible,"onUpdate:visible":m[2]||(m[2]=_=>e.isBanModalVisible=_),title:"Nhập lý do khóa sản phẩm","ok-text":"Khóa","cancel-text":"Hủy",onOk:e.handleBanConfirm},{default:a(()=>[o(v,{value:e.banReason,"onUpdate:value":m[1]||(m[1]=_=>e.banReason=_),placeholder:"Nhập lý do"},null,8,["value"])]),_:1},8,["visible","onOk"])],64)):d("",!0)]),_:1},8,["dataSource","columns"]),p("div",ye,[o(h,{onChange:e.onChange,current:e.pageParam.currentPage,"onUpdate:current":m[3]||(m[3]=r=>e.pageParam.currentPage=r),total:e.pageParam.totalItems,pageSize:e.pageParam.pageSize,"show-total":(r,S)=>`${S[0]}-${S[1]} của ${r} sản phẩm`,class:"mt-2 text-end"},null,8,["onChange","current","total","pageSize","show-total"])])])])]),_:1})}const Ce=ee(te,[["render",ve],["__scopeId","data-v-4b16a2c5"]]);export{Ce as default};
