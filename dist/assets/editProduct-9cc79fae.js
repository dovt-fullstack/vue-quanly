import{d as J,v as z,a as O,r as g,x as V,U as A,o as K,J as j,b as d,e as u,z as R,w as s,q as B,y as I,g as m,h as r,j as y,f as p,t as h,l as v,K as Q,F as Y,M as H,p as W,k as X}from"./index-64ce397b.js";import{u as Z}from"./use-menu-6afec9f3.js";import{_ as x}from"./_plugin-vue_export-helper-c27b6911.js";const ee=J({setup(){Z().onSelectedKeys(["admin-users"]);const e=z(),l=O(),k="http://localhost:9000",w=l.params.id,N=g(),M=g({}),_=JSON.parse(localStorage.getItem("token"));let f;g();const a=V({productName:"",price:"",description:"",productType:"",productTypeId:"",productTypeName:"",status:0,avatarProduct:"",avatarFile:null,discount:"",quantity:"",loading:!1}),c=g(!1);A(c,t=>{a.status=t?1:0});const i=g([]),q=t=>{const o=t.target.files[0];this.formState.avatarFile=o},b=g(null),T=g(""),C={productName:[{required:!0,message:"Tên sản phẩm không để trống.",trigger:"change"}],price:[{required:!0,message:"Giá không để trống.",trigger:"change"}],description:[{required:!0,message:"Mô tả không để trống.",trigger:"change"}],productTypeId:[{required:!0,message:"Loại sản phẩm không để trống.",trigger:"change"}]},S={labelCol:{span:4},wrapperCol:{span:14}},P=t=>{console.log("Selected productTypeName:",t),console.log("formState.productTypeName:",this.formState.productTypeId)},F=()=>{N.value.resetFields()},n=()=>{history.length>1?history.go(-1):this.$router.push("/")},D=async()=>{try{const t=await B.get(`${k}/api/v1/product/info/${w}`);console.log(t.data.data,"response");const o=t.data.data;f=o.storeId,a.productName=o.productName,a.price=o.price,a.quantity=o.quantity,a.discount=o.discount,a.status=o.status,c.value=o.status===1,a.description=o.description,a.productTypeId=o.productTypeId,a.avatarProduct=o.avatarProduct,a.loading=!1}catch(t){console.error(t)}try{const t=await B.get(`${k}/api/v1/management/${f}/producttype/view`,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${_}`}});t.data.status==="OK"?(console.log(t.data),i.value=t.data.data):console.error(t.data.message)}catch(t){console.error(t)}},E=t=>{const o=t.target.files[0];if(!o)return;if(!(o.type==="image/jpeg"||o.type==="image/png")){I.error("You can only upload JPG/PNG file!");return}if(!(o.size/1024/1024<2)){I.error("Image must smaller than 2MB!");return}const U=new FileReader;U.onloadend=()=>{T.value=U.result,b.value=o},U.readAsDataURL(o)},G=async()=>{const t=new FormData;a.loading=!0;try{if(w)t.append("productId",w);else throw new Error("Product ID is missing");if(a.price)t.append("price",a.price);else throw new Error("Price is missing");if(a.productName)t.append("name",a.productName);else throw new Error("Product Name is missing");if(t.append("discount",a.discount),t.append("quantity",a.quantity),a.description)t.append("description",a.description);else throw new Error("Description is missing");t.append("productType",a.productTypeId),b.value?t.append("avatar",b.value):t.append("avatar",a.avatarProduct),t.append("status",c.value);for(let $ of t.entries())console.log($[0]+", "+$[1]);const o=await B.put(`${k}/api/v1/management/${f}/product/edit`,t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${_}`}});I.success("Sửa thành công!"),a.loading=!1,e.push({name:"ProductByStore",params:{id:f}})}catch(o){console.error("Error during form submission:",o),I.error("Có lỗi xảy ra khi sửa sản phẩm: "+o.message)}finally{a.loading=!1}};return K(()=>{D()}),{...j(a),errors:M,isSelling:c,route:l,router:e,formRef:N,rules:C,layout:S,formState:a,resetForm:F,createUsers:G,previewFiles:E,productTypes:i,handleChange:P,goBack:n,newImage:T,handleFileUpload:q}}}),L=e=>(W("data-v-bf70aac0"),e=e(),X(),e),te={class:"row mb-3"},ae={class:"col-12"},re=L(()=>m("h1",null,"Sửa sản phẩm",-1)),oe={class:"col-12 col-sm-12 mb-3"},se={class:"row"},ne={class:"col-12"},le={key:0,class:"text-danger"},ie={key:0,class:"text-danger"},de={key:0,class:"text-danger"},ue={key:0,class:"text-danger"},ce={key:0,class:"text-danger"},pe={key:0,class:"text-danger"},me={class:"avatar-container"},fe=["src"],ge=["src"],he=L(()=>m("span",null,"Quay lại",-1));function ye(e,l,k,w,N,M){const _=d("router-link"),f=d("a-breadcrumb-item"),a=d("a-breadcrumb"),c=d("a-input"),i=d("a-form-item"),q=d("a-switch"),b=d("a-textarea"),T=d("a-select-option"),C=d("a-select"),S=d("a-button"),P=d("a-form"),F=d("a-card");return u(),R(F,{style:{width:"100%"}},{default:s(()=>[m("div",te,[m("div",ae,[r(a,null,{default:s(()=>[r(f,null,{default:s(()=>[r(_,{to:{name:"admin-dashboards"}},{default:s(()=>[y("Trang chủ")]),_:1})]),_:1}),r(f,null,{default:s(()=>[r(_,{to:{name:"admin-users"}},{default:s(()=>[y("Product")]),_:1})]),_:1}),r(f,null,{default:s(()=>[y("sửa")]),_:1})]),_:1}),re]),m("div",oe,[r(P,H({class:"p-3",name:"custom-validation",ref:"formRef",model:e.formState,rules:e.rules},e.layout,{onFinish:e.createUsers}),{default:s(()=>[m("div",se,[m("div",ne,[r(i,{ref:"productName",label:"Tên sản phẩm",required:"",name:"productName"},{default:s(()=>[r(c,{value:e.formState.productName,"onUpdate:value":l[0]||(l[0]=n=>e.formState.productName=n)},null,8,["value"]),e.errors&&e.errors.productName?(u(),p("small",le,h(e.errors.productName[0]),1)):v("",!0)]),_:1},512),r(i,{ref:"price",label:"Giá",required:"",name:"price"},{default:s(()=>[r(c,{value:e.formState.price,"onUpdate:value":l[1]||(l[1]=n=>e.formState.price=n)},null,8,["value"]),e.errors&&e.errors.price?(u(),p("small",ie,h(e.errors.price[0]),1)):v("",!0)]),_:1},512),r(i,{ref:"discount",label:"Giảm giá",required:"",name:"discount"},{default:s(()=>[r(c,{value:e.formState.discount,"onUpdate:value":l[2]||(l[2]=n=>e.formState.discount=n)},null,8,["value"]),e.errors&&e.errors.discount?(u(),p("small",de,h(e.errors.discount[0]),1)):v("",!0)]),_:1},512),r(i,{ref:"quantity",label:"Số lượng đăng bán",required:"",name:"quantity"},{default:s(()=>[r(c,{value:e.formState.quantity,"onUpdate:value":l[3]||(l[3]=n=>e.formState.quantity=n)},null,8,["value"]),e.errors&&e.errors.quantity?(u(),p("small",ue,h(e.errors.quantity[0]),1)):v("",!0)]),_:1},512),r(i,{ref:"status",label:"Trạng thái",name:"status"},{default:s(()=>[r(q,{checked:e.isSelling,"onUpdate:checked":l[4]||(l[4]=n=>e.isSelling=n),"checked-children":"Đang bán","un-checked-children":"Ngừng bán"},null,8,["checked"]),e.errors&&e.errors.status?(u(),p("small",ce,h(e.errors.status[0]),1)):v("",!0)]),_:1},512),r(i,{ref:"description",label:"Mô tả",required:"",name:"description"},{default:s(()=>[r(b,{value:e.formState.description,"onUpdate:value":l[5]||(l[5]=n=>e.formState.description=n)},null,8,["value"]),e.errors&&e.errors.description?(u(),p("small",pe,h(e.errors.description[0]),1)):v("",!0)]),_:1},512),r(i,{ref:"productTypeId",label:"Loại sản phẩm",name:"productTypeId"},{default:s(()=>[r(C,{value:e.formState.productTypeId,"onUpdate:value":l[6]||(l[6]=n=>e.formState.productTypeId=n),style:{width:"100%"},placeholder:"Chọn loại sản phẩm",onChange:e.handleChange},{default:s(()=>[(u(!0),p(Y,null,Q(e.productTypes,n=>(u(),R(T,{key:n.productTypeId,value:n.productTypeId},{default:s(()=>[y(h(n.productTypeName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onChange"])]),_:1},512),r(i,{label:"Ảnh đại diện mới"},{default:s(()=>[m("input",{type:"file",onChange:l[7]||(l[7]=(...n)=>e.previewFiles&&e.previewFiles(...n))},null,32),m("div",me,[e.newImage?(u(),p("img",{key:0,src:e.newImage,class:"avatar",alt:"avatar"},null,8,fe)):(u(),p("img",{key:1,src:e.formState.avatarProduct,class:"avatar",alt:"avatar"},null,8,ge))])]),_:1}),r(i,{"wrapper-col":{span:14,offset:4}},{default:s(()=>[r(S,{onClick:e.goBack,class:"me-0 me-sm-2 mb-3 mb-sm-0"},{default:s(()=>[he]),_:1},8,["onClick"]),r(S,{class:"me-0 me-sm-2 mb-3 mb-sm-0 bg-info text-light",onClick:e.resetForm},{default:s(()=>[y("Reset")]),_:1},8,["onClick"]),r(S,{type:"primary","html-type":"submit",class:"bg-success",loading:e.formState.loading},{default:s(()=>[y("Lưu")]),_:1},8,["loading"])]),_:1})])])]),_:1},16,["model","rules","onFinish"])])])]),_:1})}const ke=x(ee,[["render",ye],["__scopeId","data-v-bf70aac0"]]);export{ke as default};
