import{a as l,t as X,x as A,y as r,z as i,C as s,E as d,I as C,b as c,F as p,Q as w,V as x,p as M,a3 as U,N as V,a1 as F,a4 as j,J as K,K as Y}from"./index-cdcf547c.js";import{_ as q}from"./_plugin-vue_export-helper-c27b6911.js";const Z={setup(){const m=l(null),t="http://localhost:9000",y=l(!1),a=l(null),u=l({firstname:"",lastname:"",phoneNumber:"",address:"",avatar:""}),k=l(null),f=l(""),v=l([]),D=l([]),_=l([]),e=l("0"),b=l("0"),I=l("0"),O=l(""),L=(n,o)=>{u.value[n]=o.target.value},T=async()=>{try{const n=await w.get("https://esgoo.net/api-tinhthanh/1/0.htm");n.data.error===0&&(v.value=n.data.data)}catch(n){console.error(n)}},z=async()=>{if(e.value!=="0")try{const n=await w.get(`https://esgoo.net/api-tinhthanh/2/${e.value}.htm`);n.data.error===0&&(D.value=n.data.data,_.value=[],b.value="0",I.value="0",P())}catch(n){console.error(n)}},H=async()=>{if(b.value!=="0")try{const n=await w.get(`https://esgoo.net/api-tinhthanh/3/${b.value}.htm`);n.data.error===0&&(_.value=n.data.data,I.value="0",P())}catch(n){console.error(n)}},P=()=>{var S,g,W;const n=((S=v.value.find(N=>N.id===e.value))==null?void 0:S.full_name)||"",o=((g=D.value.find(N=>N.id===b.value))==null?void 0:g.full_name)||"",J=((W=_.value.find(N=>N.id===I.value))==null?void 0:W.full_name)||"";u.value.address=`${O.value}, ${J}, ${o}, ${n}`.trim()},B=async()=>{try{const n=JSON.parse(localStorage.getItem("token")),o=await w.get(`${t}/api/v1/account/profile/view`,{headers:{Authorization:`Bearer ${n}`}});m.value=o.data.data,u.value={...o.data.data},f.value=o.data.data.avatar}catch(n){console.error(n)}},Q=n=>{const o=n.target.files[0];if(!o)return;if(!(o.type==="image/jpeg"||o.type==="image/png")){x.error("You can only upload JPG/PNG file!");return}if(!(o.size/1024/1024<2)){x.error("Image must smaller than 2MB!");return}const g=new FileReader;g.onloadend=()=>{f.value=g.result,k.value=o},g.readAsDataURL(o)},E=()=>{y.value=!0},G=async()=>{try{const n=JSON.parse(localStorage.getItem("token")),o=new FormData;o.append("firstname",u.value.firstname),o.append("lastname",u.value.lastname),o.append("phoneNumber",u.value.phoneNumber),o.append("address",u.value.address),k.value&&o.append("avatar",k.value),await w.put(`${t}/api/v1/account/profile/update`,o,{headers:{Authorization:`Bearer ${n}`}}),x.success("Cập nhật thông tin thành công"),y.value=!1,B()}catch(n){console.error(n),x.error("Có lỗi xảy ra khi cập nhật thông tin")}},R=()=>{y.value=!1};return X(()=>{B(),T()}),{userData:m,isModalVisible:y,form:a,formData:u,showModal:E,handleOk:G,handleCancel:R,handleInputChange:L,provinces:v,districts:D,wards:_,selectedProvince:e,selectedDistrict:b,selectedWard:I,houseNumber:O,fetchProvinces:T,fetchDistricts:z,fetchWards:H,updateAddress:P,newImage:f,previewFiles:Q}}},h=m=>(K("data-v-b5ee5a52"),m=m(),Y(),m),$={class:"user-profile"},aa={key:0,class:"card"},ea={class:"card-header"},ta=["src"],na={class:"card-body"},sa={class:"user-name"},oa={class:"user-info"},la=h(()=>s("strong",null,"Họ:",-1)),ra=h(()=>s("strong",null,"Tên:",-1)),ia=h(()=>s("strong",null,"Số điện thoại:",-1)),da=h(()=>s("strong",null,"Địa chỉ:",-1)),ca=h(()=>s("strong",null,"Mạng xã hội:",-1)),ua={class:"card-footer"},va={key:1,class:"loading"},ha={class:"css_select_div"},ma=h(()=>s("option",{value:"0"},"Tỉnh Thành",-1)),fa=["value"],pa=h(()=>s("option",{value:"0"},"Quận Huyện",-1)),_a=["value"],ga=h(()=>s("option",{value:"0"},"Phường Xã",-1)),ya=["value"],Da={class:"avatar-container"},ba=["src"],Na=["src"];function Ca(m,t,y,a,u,k){const f=A("a-input"),v=A("a-form-item"),D=A("a-form"),_=A("a-modal");return r(),i("div",$,[a.userData?(r(),i("div",aa,[s("div",ea,[s("img",{src:a.userData.avatar,alt:"User Avatar",class:"avatar"},null,8,ta)]),s("div",na,[s("h2",sa,d(a.userData.firstname)+" "+d(a.userData.lastname),1),s("div",oa,[s("p",null,[la,C(" "+d(a.userData.firstname||"N/A"),1)]),s("p",null,[ra,C(" "+d(a.userData.lastname||"N/A"),1)]),s("p",null,[ia,C(" "+d(a.userData.phoneNumber||"N/A"),1)]),s("p",null,[da,C(" "+d(a.userData.address||"N/A"),1)]),s("p",null,[ca,C(" "+d(a.userData.socialContact||"N/A"),1)])])]),s("div",ua,[s("button",{onClick:t[0]||(t[0]=(...e)=>a.showModal&&a.showModal(...e)),class:"edit-button"},"Chỉnh sửa")])])):(r(),i("div",va,"Loading...")),c(_,{visible:a.isModalVisible,"onUpdate:visible":t[16]||(t[16]=e=>a.isModalVisible=e),title:"Chỉnh sửa thông tin",onOk:a.handleOk,onCancel:a.handleCancel},{default:p(()=>[c(D,{form:a.form,layout:"vertical"},{default:p(()=>[c(v,{label:"Họ"},{default:p(()=>[c(f,{value:a.formData.firstname,"onUpdate:value":t[1]||(t[1]=e=>a.formData.firstname=e),onInput:t[2]||(t[2]=e=>a.handleInputChange("firstname",e))},null,8,["value"])]),_:1}),c(v,{label:"Tên"},{default:p(()=>[c(f,{value:a.formData.lastname,"onUpdate:value":t[3]||(t[3]=e=>a.formData.lastname=e),onInput:t[4]||(t[4]=e=>a.handleInputChange("lastname",e))},null,8,["value"])]),_:1}),c(v,{label:"Số điện thoại"},{default:p(()=>[c(f,{value:a.formData.phoneNumber,"onUpdate:value":t[5]||(t[5]=e=>a.formData.phoneNumber=e),onInput:t[6]||(t[6]=e=>a.handleInputChange("phoneNumber",e))},null,8,["value"])]),_:1}),c(v,{label:"Địa chỉ"},{default:p(()=>[s("div",ha,[M(s("select",{class:"css_select","onUpdate:modelValue":t[7]||(t[7]=e=>a.selectedProvince=e),onChange:t[8]||(t[8]=(...e)=>a.fetchDistricts&&a.fetchDistricts(...e)),title:"Chọn Tỉnh Thành"},[ma,(r(!0),i(V,null,F(a.provinces,e=>(r(),i("option",{key:e.id,value:e.id},d(e.full_name),9,fa))),128))],544),[[U,a.selectedProvince]]),M(s("select",{class:"css_select","onUpdate:modelValue":t[9]||(t[9]=e=>a.selectedDistrict=e),onChange:t[10]||(t[10]=(...e)=>a.fetchWards&&a.fetchWards(...e)),title:"Chọn Quận Huyện"},[pa,(r(!0),i(V,null,F(a.districts,e=>(r(),i("option",{key:e.id,value:e.id},d(e.full_name),9,_a))),128))],544),[[U,a.selectedDistrict]]),M(s("select",{class:"css_select","onUpdate:modelValue":t[11]||(t[11]=e=>a.selectedWard=e),onChange:t[12]||(t[12]=(...e)=>a.updateAddress&&a.updateAddress(...e)),title:"Chọn Phường Xã"},[ga,(r(!0),i(V,null,F(a.wards,e=>(r(),i("option",{key:e.id,value:e.id},d(e.full_name),9,ya))),128))],544),[[U,a.selectedWard]]),M(s("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>a.houseNumber=e),onInput:t[14]||(t[14]=(...e)=>a.updateAddress&&a.updateAddress(...e)),placeholder:"Số nhà"},null,544),[[j,a.houseNumber]])])]),_:1}),c(v,{label:"Ảnh đại diện mới"},{default:p(()=>[s("input",{type:"file",onChange:t[15]||(t[15]=(...e)=>a.previewFiles&&a.previewFiles(...e))},null,32),s("div",Da,[a.newImage?(r(),i("img",{key:0,src:a.newImage,class:"avatar",alt:"avatar"},null,8,ba)):(r(),i("img",{key:1,src:a.userData.avatar,class:"avatar",alt:"avatar"},null,8,Na))])]),_:1})]),_:1},8,["form"])]),_:1},8,["visible","onOk","onCancel"])])}const Ia=q(Z,[["render",Ca],["__scopeId","data-v-b5ee5a52"]]);export{Ia as default};
