import{a as i,c as _,t as ue,x as D,y as v,z as h,C as n,E as f,I as M,b as r,F as c,Q as b,V as p,p as x,a3 as T,N as B,a1 as J,a4 as ce,J as ve,K as he}from"./index-cdcf547c.js";import{_ as fe}from"./_plugin-vue_export-helper-c27b6911.js";const me={setup(){const g=i(null),s="http://localhost:9000",C=i(!1),e=i(!1),W=i(null),z=i(null),d=i({firstname:"",lastname:"",phoneNumber:"",address:"",avatar:""}),l=i({oldPass:"",newPass:"",confirmNewPass:""}),u=i(null),P=i(""),w=i([]),a=i([]),V=i([]),I=i("0"),N=i("0"),S=i("0"),L=i(""),U=i(!1),O=i(!1),A=i(!1),R=(t,o)=>{d.value[t]=o.target.value},j=(t,o)=>{l.value[t]=o.target.value},K=t=>{t==="oldPass"?U.value=!U.value:t==="newPass"?O.value=!O.value:t==="confirmNewPass"&&(A.value=!A.value)},Y=_(()=>l.value.oldPass.length>=8?"success":"error"),q=_(()=>l.value.oldPass.length>=8?"":"Mật khẩu phải có tối thiểu 8 ký tự"),Z=_(()=>l.value.newPass.length<8||l.value.newPass===l.value.oldPass?"error":"success"),$=_(()=>l.value.newPass.length<8?"Mật khẩu phải có tối thiểu 8 ký tự":l.value.newPass===l.value.oldPass?"Mật khẩu mới phải khác mật khẩu cũ":""),ee=_(()=>l.value.confirmNewPass.length<8||l.value.newPass!==l.value.confirmNewPass?"error":"success"),ae=_(()=>l.value.confirmNewPass.length<8?"Mật khẩu phải có tối thiểu 8 ký tự":l.value.newPass!==l.value.confirmNewPass?"Xác nhận mật khẩu mới không khớp":""),X=async()=>{try{const t=await b.get("https://esgoo.net/api-tinhthanh/1/0.htm");t.data.error===0&&(w.value=t.data.data)}catch(t){console.error(t)}},se=async()=>{if(I.value!=="0")try{const t=await b.get(`https://esgoo.net/api-tinhthanh/2/${I.value}.htm`);t.data.error===0&&(a.value=t.data.data,V.value=[],N.value="0",S.value="0",H())}catch(t){console.error(t)}},te=async()=>{if(N.value!=="0")try{const t=await b.get(`https://esgoo.net/api-tinhthanh/3/${N.value}.htm`);t.data.error===0&&(V.value=t.data.data,S.value="0",H())}catch(t){console.error(t)}},H=()=>{var F,y,G;const t=((F=w.value.find(k=>k.id===I.value))==null?void 0:F.full_name)||"",o=((y=a.value.find(k=>k.id===N.value))==null?void 0:y.full_name)||"",E=((G=V.value.find(k=>k.id===S.value))==null?void 0:G.full_name)||"";d.value.address=`${L.value}, ${E}, ${o}, ${t}`.trim()},Q=async()=>{try{const t=JSON.parse(localStorage.getItem("token")),o=await b.get(`${s}/api/v1/account/profile/view`,{headers:{Authorization:`Bearer ${t}`}});g.value=o.data.data,d.value={...o.data.data},P.value=o.data.data.avatar}catch(t){console.error(t)}},ne=t=>{const o=t.target.files[0];if(!o)return;if(!(o.type==="image/jpeg"||o.type==="image/png")){p.error("You can only upload JPG/PNG file!");return}if(!(o.size/1024/1024<2)){p.error("Image must smaller than 2MB!");return}const y=new FileReader;y.onloadend=()=>{P.value=y.result,u.value=o},y.readAsDataURL(o)},le=()=>{C.value=!0},oe=()=>{e.value=!0},re=async()=>{try{const t=JSON.parse(localStorage.getItem("token")),o={oldPassword:l.value.oldPass,newPassword:l.value.newPass};await b.post(`${s}/api/v1/auth/changepassword`,o,{headers:{Authorization:`Bearer ${t}`}}),p.success("Đổi mật khẩu thành công"),e.value=!1,l.value.oldPass="",l.value.newPass="",l.value.confirmNewPass=""}catch(t){t.response&&t.response.data?p.error(t.response.data):p.error("Đã xảy ra lỗi")}},ie=async()=>{try{const t=JSON.parse(localStorage.getItem("token")),o=new FormData;o.append("firstname",d.value.firstname),o.append("lastname",d.value.lastname),o.append("phoneNumber",d.value.phoneNumber),o.append("address",d.value.address),u.value&&o.append("avatar",u.value),await b.put(`${s}/api/v1/account/profile/update`,o,{headers:{Authorization:`Bearer ${t}`}}),p.success("Cập nhật thông tin thành công"),C.value=!1,Q()}catch(t){console.error(t),p.error("Có lỗi xảy ra khi cập nhật thông tin")}},de=()=>{C.value=!1,e.value=!1};return ue(()=>{Q(),X()}),{userData:g,isModalVisible:C,isModalVisible2:e,form:W,form2:z,formData:d,formDataChangePass:l,isOldPassVisible:U,isNewPassVisible:O,isConfirmNewPassVisible:A,showModal:le,showModal2:oe,handleOk:ie,handleChangePass:re,handleCancel:de,handleInputChange:R,handleInputChange2:j,togglePasswordVisibility:K,getOldPassStatus:Y,oldPassHelpMessage:q,getNewPassStatus:Z,newPassHelpMessage:$,getConfirmNewPassStatus:ee,confirmNewPassHelpMessage:ae,provinces:w,districts:a,wards:V,selectedProvince:I,selectedDistrict:N,selectedWard:S,houseNumber:L,fetchProvinces:X,fetchDistricts:se,fetchWards:te,updateAddress:H,newImage:P,previewFiles:ne}}},m=g=>(ve("data-v-fc0b4372"),g=g(),he(),g),ge={class:"user-profile"},pe={key:0,class:"card"},Pe={class:"card-header"},we=["src"],ye={class:"card-body"},_e={class:"user-name"},be={class:"user-info"},Ce=m(()=>n("strong",null,"Họ:",-1)),Ne=m(()=>n("strong",null,"Tên:",-1)),ke=m(()=>n("strong",null,"Số điện thoại:",-1)),De=m(()=>n("strong",null,"Địa chỉ:",-1)),Me=m(()=>n("strong",null,"Mạng xã hội:",-1)),Ve={class:"d-flex"},Ie={class:"card-footer"},Se={class:"card-footer"},xe={key:1,class:"loading"},Ue={class:"css_select_div"},Oe=m(()=>n("option",{value:"0"},"Tỉnh Thành",-1)),Ae=["value"],He=m(()=>n("option",{value:"0"},"Quận Huyện",-1)),Fe=["value"],Te=m(()=>n("option",{value:"0"},"Phường Xã",-1)),Be=["value"],Je={class:"avatar-container"},We=["src"],ze=["src"];function Le(g,s,C,e,W,z){const d=D("a-input"),l=D("a-icon"),u=D("a-form-item"),P=D("a-form"),w=D("a-modal");return v(),h("div",ge,[e.userData?(v(),h("div",pe,[n("div",Pe,[n("img",{src:e.userData.avatar,alt:"User Avatar",class:"avatar"},null,8,we)]),n("div",ye,[n("h2",_e,f(e.userData.firstname)+" "+f(e.userData.lastname),1),n("div",be,[n("p",null,[Ce,M(" "+f(e.userData.firstname||"N/A"),1)]),n("p",null,[Ne,M(" "+f(e.userData.lastname||"N/A"),1)]),n("p",null,[ke,M(" "+f(e.userData.phoneNumber||"N/A"),1)]),n("p",null,[De,M(" "+f(e.userData.address||"N/A"),1)]),n("p",null,[Me,M(" "+f(e.userData.socialContact||"N/A"),1)])])]),n("div",Ve,[n("div",Ie,[n("button",{onClick:s[0]||(s[0]=(...a)=>e.showModal&&e.showModal(...a)),class:"edit-button"},"Chỉnh sửa")]),n("div",Se,[n("button",{onClick:s[1]||(s[1]=(...a)=>e.showModal2&&e.showModal2(...a)),class:"edit-button"},"Đổi mật khẩu")])])])):(v(),h("div",xe,"Loading...")),r(w,{visible:e.isModalVisible2,"onUpdate:visible":s[11]||(s[11]=a=>e.isModalVisible2=a),title:"Đổi mật khẩu",onOk:e.handleChangePass,onCancel:e.handleCancel},{default:c(()=>[r(P,{form:e.form2,layout:"vertical"},{default:c(()=>[r(u,{label:"Mật khẩu cũ",validateStatus:e.getOldPassStatus,help:e.oldPassHelpMessage},{default:c(()=>[r(d,{type:e.isOldPassVisible?"text":"password",value:e.formDataChangePass.oldPass,"onUpdate:value":s[2]||(s[2]=a=>e.formDataChangePass.oldPass=a),onInput:s[3]||(s[3]=a=>e.handleInputChange2("oldPass",a))},null,8,["type","value"]),r(l,{type:e.isOldPassVisible?"eye-invisible":"eye",onClick:s[4]||(s[4]=a=>e.togglePasswordVisibility("oldPass"))},null,8,["type"])]),_:1},8,["validateStatus","help"]),r(u,{label:"Mật khẩu mới",validateStatus:e.getNewPassStatus,help:e.newPassHelpMessage},{default:c(()=>[r(d,{type:e.isNewPassVisible?"text":"password",value:e.formDataChangePass.newPass,"onUpdate:value":s[5]||(s[5]=a=>e.formDataChangePass.newPass=a),onInput:s[6]||(s[6]=a=>e.handleInputChange2("newPass",a))},null,8,["type","value"]),r(l,{type:e.isNewPassVisible?"eye-invisible":"eye",onClick:s[7]||(s[7]=a=>e.togglePasswordVisibility("newPass"))},null,8,["type"])]),_:1},8,["validateStatus","help"]),r(u,{label:"Xác nhận mật khẩu mới",validateStatus:e.getConfirmNewPassStatus,help:e.confirmNewPassHelpMessage},{default:c(()=>[r(d,{type:e.isConfirmNewPassVisible?"text":"password",value:e.formDataChangePass.confirmNewPass,"onUpdate:value":s[8]||(s[8]=a=>e.formDataChangePass.confirmNewPass=a),onInput:s[9]||(s[9]=a=>e.handleInputChange2("confirmNewPass",a))},null,8,["type","value"]),r(l,{type:e.isConfirmNewPassVisible?"eye-invisible":"eye",onClick:s[10]||(s[10]=a=>e.togglePasswordVisibility("confirmNewPass"))},null,8,["type"])]),_:1},8,["validateStatus","help"])]),_:1},8,["form"])]),_:1},8,["visible","onOk","onCancel"]),r(w,{visible:e.isModalVisible,"onUpdate:visible":s[27]||(s[27]=a=>e.isModalVisible=a),title:"Chỉnh sửa thông tin",onOk:e.handleOk,onCancel:e.handleCancel},{default:c(()=>[r(P,{form:e.form,layout:"vertical"},{default:c(()=>[r(u,{label:"Họ"},{default:c(()=>[r(d,{value:e.formData.firstname,"onUpdate:value":s[12]||(s[12]=a=>e.formData.firstname=a),onInput:s[13]||(s[13]=a=>e.handleInputChange("firstname",a))},null,8,["value"])]),_:1}),r(u,{label:"Tên"},{default:c(()=>[r(d,{value:e.formData.lastname,"onUpdate:value":s[14]||(s[14]=a=>e.formData.lastname=a),onInput:s[15]||(s[15]=a=>e.handleInputChange("lastname",a))},null,8,["value"])]),_:1}),r(u,{label:"Số điện thoại"},{default:c(()=>[r(d,{value:e.formData.phoneNumber,"onUpdate:value":s[16]||(s[16]=a=>e.formData.phoneNumber=a),onInput:s[17]||(s[17]=a=>e.handleInputChange("phoneNumber",a))},null,8,["value"])]),_:1}),r(u,{label:"Địa chỉ"},{default:c(()=>[n("div",Ue,[x(n("select",{class:"css_select","onUpdate:modelValue":s[18]||(s[18]=a=>e.selectedProvince=a),onChange:s[19]||(s[19]=(...a)=>e.fetchDistricts&&e.fetchDistricts(...a)),title:"Chọn Tỉnh Thành"},[Oe,(v(!0),h(B,null,J(e.provinces,a=>(v(),h("option",{key:a.id,value:a.id},f(a.full_name),9,Ae))),128))],544),[[T,e.selectedProvince]]),x(n("select",{class:"css_select","onUpdate:modelValue":s[20]||(s[20]=a=>e.selectedDistrict=a),onChange:s[21]||(s[21]=(...a)=>e.fetchWards&&e.fetchWards(...a)),title:"Chọn Quận Huyện"},[He,(v(!0),h(B,null,J(e.districts,a=>(v(),h("option",{key:a.id,value:a.id},f(a.full_name),9,Fe))),128))],544),[[T,e.selectedDistrict]]),x(n("select",{class:"css_select","onUpdate:modelValue":s[22]||(s[22]=a=>e.selectedWard=a),onChange:s[23]||(s[23]=(...a)=>e.updateAddress&&e.updateAddress(...a)),title:"Chọn Phường Xã"},[Te,(v(!0),h(B,null,J(e.wards,a=>(v(),h("option",{key:a.id,value:a.id},f(a.full_name),9,Be))),128))],544),[[T,e.selectedWard]]),x(n("input",{type:"text","onUpdate:modelValue":s[24]||(s[24]=a=>e.houseNumber=a),onInput:s[25]||(s[25]=(...a)=>e.updateAddress&&e.updateAddress(...a)),placeholder:"Số nhà"},null,544),[[ce,e.houseNumber]])])]),_:1}),r(u,{label:"Ảnh đại diện mới"},{default:c(()=>[n("input",{type:"file",onChange:s[26]||(s[26]=(...a)=>e.previewFiles&&e.previewFiles(...a))},null,32),n("div",Je,[e.newImage?(v(),h("img",{key:0,src:e.newImage,class:"avatar",alt:"avatar"},null,8,We)):(v(),h("img",{key:1,src:e.userData.avatar,class:"avatar",alt:"avatar"},null,8,ze))])]),_:1})]),_:1},8,["form"])]),_:1},8,["visible","onOk","onCancel"])])}const Ee=fe(me,[["render",Le],["__scopeId","data-v-fc0b4372"]]);export{Ee as default};
