import{r as l,o as X,b as A,e as r,f as i,g as o,t as d,j as w,h as c,w as p,q as C,y as P,N as M,O as U,F as V,K as O,P as q,p as E,k as K}from"./index-64ce397b.js";import{_ as Y}from"./_plugin-vue_export-helper-c27b6911.js";const Z={setup(){const m=l(null),t="http://localhost:9000",y=l(!1),a=l(null),u=l({firstname:"",lastname:"",phoneNumber:"",address:"",avatar:""}),k=l(null),f=l(""),v=l([]),D=l([]),_=l([]),e=l("0"),b=l("0"),I=l("0"),F=l(""),L=(n,s)=>{u.value[n]=s.target.value},T=async()=>{try{const n=await C.get("https://esgoo.net/api-tinhthanh/1/0.htm");n.data.error===0&&(v.value=n.data.data)}catch(n){console.error(n)}},H=async()=>{if(e.value!=="0")try{const n=await C.get(`https://esgoo.net/api-tinhthanh/2/${e.value}.htm`);n.data.error===0&&(D.value=n.data.data,_.value=[],b.value="0",I.value="0",x())}catch(n){console.error(n)}},z=async()=>{if(b.value!=="0")try{const n=await C.get(`https://esgoo.net/api-tinhthanh/3/${b.value}.htm`);n.data.error===0&&(_.value=n.data.data,I.value="0",x())}catch(n){console.error(n)}},x=()=>{var S,g,J;const n=((S=v.value.find(N=>N.id===e.value))==null?void 0:S.full_name)||"",s=((g=D.value.find(N=>N.id===b.value))==null?void 0:g.full_name)||"",W=((J=_.value.find(N=>N.id===I.value))==null?void 0:J.full_name)||"";u.value.address=`${F.value}, ${W}, ${s}, ${n}`.trim()},B=async()=>{try{const n=JSON.parse(localStorage.getItem("token")),s=await C.get(`${t}/api/v1/account/profile/view`,{headers:{Authorization:`Bearer ${n}`}});m.value=s.data.data,u.value={...s.data.data},f.value=s.data.data.avatar}catch(n){console.error(n)}},j=n=>{const s=n.target.files[0];if(!s)return;if(!(s.type==="image/jpeg"||s.type==="image/png")){P.error("You can only upload JPG/PNG file!");return}if(!(s.size/1024/1024<2)){P.error("Image must smaller than 2MB!");return}const g=new FileReader;g.onloadend=()=>{f.value=g.result,k.value=s},g.readAsDataURL(s)},G=()=>{y.value=!0},Q=async()=>{try{const n=JSON.parse(localStorage.getItem("token")),s=new FormData;s.append("firstname",u.value.firstname),s.append("lastname",u.value.lastname),s.append("phoneNumber",u.value.phoneNumber),s.append("address",u.value.address),k.value&&s.append("avatar",k.value),await C.put(`${t}/api/v1/account/profile/update`,s,{headers:{Authorization:`Bearer ${n}`}}),P.success("Cập nhật thông tin thành công"),y.value=!1,B()}catch(n){console.error(n),P.error("Có lỗi xảy ra khi cập nhật thông tin")}},R=()=>{y.value=!1};return X(()=>{B(),T()}),{userData:m,isModalVisible:y,form:a,formData:u,showModal:G,handleOk:Q,handleCancel:R,handleInputChange:L,provinces:v,districts:D,wards:_,selectedProvince:e,selectedDistrict:b,selectedWard:I,houseNumber:F,fetchProvinces:T,fetchDistricts:H,fetchWards:z,updateAddress:x,newImage:f,previewFiles:j}}},h=m=>(E("data-v-b5ee5a52"),m=m(),K(),m),$={class:"user-profile"},aa={key:0,class:"card"},ea={class:"card-header"},ta=["src"],na={class:"card-body"},oa={class:"user-name"},sa={class:"user-info"},la=h(()=>o("strong",null,"Họ:",-1)),ra=h(()=>o("strong",null,"Tên:",-1)),ia=h(()=>o("strong",null,"Số điện thoại:",-1)),da=h(()=>o("strong",null,"Địa chỉ:",-1)),ca=h(()=>o("strong",null,"Mạng xã hội:",-1)),ua={class:"card-footer"},va={key:1,class:"loading"},ha={class:"css_select_div"},ma=h(()=>o("option",{value:"0"},"Tỉnh Thành",-1)),fa=["value"],pa=h(()=>o("option",{value:"0"},"Quận Huyện",-1)),_a=["value"],ga=h(()=>o("option",{value:"0"},"Phường Xã",-1)),ya=["value"],Da={class:"avatar-container"},ba=["src"],Na=["src"];function wa(m,t,y,a,u,k){const f=A("a-input"),v=A("a-form-item"),D=A("a-form"),_=A("a-modal");return r(),i("div",$,[a.userData?(r(),i("div",aa,[o("div",ea,[o("img",{src:a.userData.avatar,alt:"User Avatar",class:"avatar"},null,8,ta)]),o("div",na,[o("h2",oa,d(a.userData.firstname)+" "+d(a.userData.lastname),1),o("div",sa,[o("p",null,[la,w(" "+d(a.userData.firstname||"N/A"),1)]),o("p",null,[ra,w(" "+d(a.userData.lastname||"N/A"),1)]),o("p",null,[ia,w(" "+d(a.userData.phoneNumber||"N/A"),1)]),o("p",null,[da,w(" "+d(a.userData.address||"N/A"),1)]),o("p",null,[ca,w(" "+d(a.userData.socialContact||"N/A"),1)])])]),o("div",ua,[o("button",{onClick:t[0]||(t[0]=(...e)=>a.showModal&&a.showModal(...e)),class:"edit-button"},"Chỉnh sửa")])])):(r(),i("div",va,"Loading...")),c(_,{visible:a.isModalVisible,"onUpdate:visible":t[16]||(t[16]=e=>a.isModalVisible=e),title:"Chỉnh sửa thông tin",onOk:a.handleOk,onCancel:a.handleCancel},{default:p(()=>[c(D,{form:a.form,layout:"vertical"},{default:p(()=>[c(v,{label:"Họ"},{default:p(()=>[c(f,{value:a.formData.firstname,"onUpdate:value":t[1]||(t[1]=e=>a.formData.firstname=e),onInput:t[2]||(t[2]=e=>a.handleInputChange("firstname",e))},null,8,["value"])]),_:1}),c(v,{label:"Tên"},{default:p(()=>[c(f,{value:a.formData.lastname,"onUpdate:value":t[3]||(t[3]=e=>a.formData.lastname=e),onInput:t[4]||(t[4]=e=>a.handleInputChange("lastname",e))},null,8,["value"])]),_:1}),c(v,{label:"Số điện thoại"},{default:p(()=>[c(f,{value:a.formData.phoneNumber,"onUpdate:value":t[5]||(t[5]=e=>a.formData.phoneNumber=e),onInput:t[6]||(t[6]=e=>a.handleInputChange("phoneNumber",e))},null,8,["value"])]),_:1}),c(v,{label:"Địa chỉ"},{default:p(()=>[o("div",ha,[M(o("select",{class:"css_select","onUpdate:modelValue":t[7]||(t[7]=e=>a.selectedProvince=e),onChange:t[8]||(t[8]=(...e)=>a.fetchDistricts&&a.fetchDistricts(...e)),title:"Chọn Tỉnh Thành"},[ma,(r(!0),i(V,null,O(a.provinces,e=>(r(),i("option",{key:e.id,value:e.id},d(e.full_name),9,fa))),128))],544),[[U,a.selectedProvince]]),M(o("select",{class:"css_select","onUpdate:modelValue":t[9]||(t[9]=e=>a.selectedDistrict=e),onChange:t[10]||(t[10]=(...e)=>a.fetchWards&&a.fetchWards(...e)),title:"Chọn Quận Huyện"},[pa,(r(!0),i(V,null,O(a.districts,e=>(r(),i("option",{key:e.id,value:e.id},d(e.full_name),9,_a))),128))],544),[[U,a.selectedDistrict]]),M(o("select",{class:"css_select","onUpdate:modelValue":t[11]||(t[11]=e=>a.selectedWard=e),onChange:t[12]||(t[12]=(...e)=>a.updateAddress&&a.updateAddress(...e)),title:"Chọn Phường Xã"},[ga,(r(!0),i(V,null,O(a.wards,e=>(r(),i("option",{key:e.id,value:e.id},d(e.full_name),9,ya))),128))],544),[[U,a.selectedWard]]),M(o("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>a.houseNumber=e),onInput:t[14]||(t[14]=(...e)=>a.updateAddress&&a.updateAddress(...e)),placeholder:"Số nhà"},null,544),[[q,a.houseNumber]])])]),_:1}),c(v,{label:"Ảnh đại diện mới"},{default:p(()=>[o("input",{type:"file",onChange:t[15]||(t[15]=(...e)=>a.previewFiles&&a.previewFiles(...e))},null,32),o("div",Da,[a.newImage?(r(),i("img",{key:0,src:a.newImage,class:"avatar",alt:"avatar"},null,8,ba)):(r(),i("img",{key:1,src:a.userData.avatar,class:"avatar",alt:"avatar"},null,8,Na))])]),_:1})]),_:1},8,["form"])]),_:1},8,["visible","onOk","onCancel"])])}const Ia=Y(Z,[["render",wa],["__scopeId","data-v-b5ee5a52"]]);export{Ia as default};
