import{d as I,u as x,x as A,o as F,q as h,c as P,y as k,b as g,e as N,f as z,g as o,h as p,w as m,m as M,X as T,Y as B,Z as C,p as E,k as H}from"./index-64ce397b.js";import{_ as R}from"./_plugin-vue_export-helper-c27b6911.js";const U=I({setup(){const a="http://localhost:9000";x();const i=A({username:"",password:""});F(()=>{localStorage.clear();const t=new URLSearchParams(window.location.search).get("token");if(t){localStorage.setItem("token",JSON.stringify(t));const n=encodeURIComponent(t);h.get(`http://localhost:9000/api/v1/auth/validtoken?token=${n}`).then(r=>{r.data?h.get(`http://localhost:9000/api/v1/auth/getUserFromToken?token=${n}`).then(s=>{console.log(s),localStorage.setItem("auth",JSON.stringify(s.data)),window.location.href="/trang-chu-stores"}).catch(s=>{console.error("Error fetching user data:",s),d("Thất bại!","Không thể lấy thông tin người dùng."),localStorage.clear(),window.location.href="/login"}):(localStorage.clear(),window.location.href="/login")})}});const w=(t,n)=>new Promise((r,s)=>{console.log(123);const y=T({apiKey:"AIzaSyBTotN9vQoBZlxQY2UG1TuGEZ7rpkWZt70",authDomain:"be-for-gr-180e7.firebaseapp.com",projectId:"be-for-gr-180e7",storageBucket:"be-for-gr-180e7.appspot.com",messagingSenderId:"483915681179",appId:"1:483915681179:web:bcc760df56ee3c5044a53e",measurementId:"G-0FG12P4QPH"}),S=B(y);C(S,{vapidKey:"BAffji7PkXTfbxfExeCdiORnNzDdfG-nYcSX-MKZ_t29PlmV87swAMV7MsN7n3tohTW6K2saSCXLS31wkR-A36o"}).then(l=>{if(l){console.log("Token is:",l);const f=new FormData;f.append("userId",n),localStorage.setItem("firebase",JSON.stringify(l)),f.append("firebaseId",l),h.post(`${a}/api/v1/notifications/subscribe/device`,f,{headers:{Authorization:`Bearer ${t}`}}).then(u=>{k.success("Thành công!"),r()}).catch(u=>{console.log(u),s(u)})}else console.log("No registration token available. Request permission to generate one."),s("No registration token available.")}).catch(l=>{console.log("An error occurred while retrieving token. ",l),s(l)})}),v=async t=>{const{username:n,password:r}=t,s={email:n,password:r};try{const e=await h.post(`${a}/api/v1/auth/authenticate`,s);console.log(e.data),localStorage.setItem("auth",JSON.stringify(e.data)),localStorage.setItem("token",JSON.stringify(e.data.accesstoken)),await w(e.data.accesstoken,e.data.userId),e.data.role=="USER"?window.location.href="/trang-chu-stores":e.data.role=="MANAGER"?e.data.storeId==0?window.location.href="/store/info-them-moi":window.location.href="/doanh-thu-store/"+e.data.storeId:e.data.role=="SHIPPER"?window.location.href="/danh-sach-don":e.data.role=="ADMIN"&&(window.location.href="/danh-sach-store")}catch(e){console.log(e),e.response&&e.response.status!==200?(d("Thất bại!","Tài khoản hoặc mật khẩu không đúng!"),console.log(e.response)):d("Thất bại!","Đăng nhập không thành công!")}},_=t=>{console.log("Failed:",t)},b=P(()=>!(i.username&&i.password)),d=(t,n)=>{k.error({content:n,duration:2})};return{formState:i,onFinishFailed:_,onFinish:v,disabled:b}}}),c=a=>(E("data-v-01c9a458"),a=a(),H(),a),V={class:"login-style sapo-sso"},$={class:"container form form-login"},G=M('<div class="login-form-view" data-v-01c9a458><div class="header" data-v-01c9a458><div class="header-image" data-v-01c9a458><img class="fade show sapo-logo" alt="Sapo" src="https://res.cloudinary.com/dqvr7kat6/image/upload/v1718268402/zu43thyvdywlzfuhxfm6.webp" data-v-01c9a458></div><div class="title mt-3" data-v-01c9a458><h1 class="title-center h4" data-v-01c9a458>Đăng nhập tài khoản</h1></div></div></div>',1),W={class:"login-form-view login-form-block"},q={class:"form-login-info"},K={class:"form-group position-relative",id:"username-input-wrapper"},L=c(()=>o("div",{class:"has-error padding-md-left padding-sm-top"},[o("span",{class:"help-block"},[o("label",{for:"username",class:"help-block field-validation-valid"})])],-1)),O={class:"form-group",id:"password-input-wrapper"},Z=c(()=>o("div",{class:"has-error padding-md-left padding-sm-top"},[o("span",{class:"help-block"},[o("label",{for:"password",class:"help-block field-validation-valid"})])],-1)),j=c(()=>o("div",{class:"form-group row margin-sm-bottom d-flex"},[o("div",{class:"col-4"},[o("a",{href:"/register",onclick:"onForgotPassword()",class:"forgot-pos-password"},"Đăng kí tài khoản mới")]),o("div",{class:"col-8"},[o("a",{href:"/forgetPassword",onclick:"onForgotPassword()",class:"forgot-pos-password"},"Quên mật khẩu")])],-1)),D=c(()=>o("div",{class:"mb-3 justify-content-center d-none",id:"g-recaptcha-wrapper"},[o("div",{class:"g-recaptcha","data-sitekey":"6LcyV7InAAAAAK-HaWzFi2P6qGdW0jrspU54bMxo"},[o("div",{style:{width:"304px",height:"78px"}},[o("div",null,[o("iframe",{title:"reCAPTCHA",width:"304",height:"78",role:"presentation",name:"a-fxam4sgkl0fb",frameborder:"0",scrolling:"no",sandbox:"allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox allow-storage-access-by-user-activation",src:"https://www.google.com/recaptcha/api2/anchor?ar=1&k=6LcyV7InAAAAAK-HaWzFi2P6qGdW0jrspU54bMxo&co=aHR0cHM6Ly9hY2NvdW50cy5zYXBvLnZuOjQ0Mw..&hl=vi&v=joHA60MeME-PNviL59xVH9zs&size=normal&cb=u8rsfktzedhv"})]),o("textarea",{id:"g-recaptcha-response",name:"g-recaptcha-response",class:"g-recaptcha-response",style:{width:"250px",height:"40px",border:"1px solid rgb(193, 193, 193)",margin:"10px 25px",padding:"0px",resize:"none",display:"none"}})]),o("iframe",{style:{display:"none"}})])],-1)),J=c(()=>o("div",{class:"text-center mb-3",style:{clear:"both"}},[o("button",{class:"btn-login",type:"submit"},"Đăng nhập")],-1)),Q=c(()=>o("div",{class:"social-login mt-3 text-center"},[o("span",{class:"social-login__label"},"Hoặc đăng nhập với"),o("div",{class:"social-login__btn-group mt-3"},[o("a",{href:"http://localhost:9000/oauth2/authorization/google",class:"social-login__item social-login--google",id:"login-with-gg"},[o("img",{src:"https://sapo.dktcdn.net/sso-service/images/svg_sociallogin_gg_new.svg",alt:"sapo",class:"fade show"})])])],-1));function X(a,i,w,v,_,b){const d=g("a-input"),t=g("a-form-item"),n=g("a-input-password"),r=g("a-form");return N(),z("div",V,[o("div",$,[G,o("div",W,[p(r,{model:a.formState,onFinish:a.onFinish,onFinishFailed:a.onFinishFailed,id:"pos-login-form",class:"content mt-4",autocomplete:"off",name:"normal_login",novalidate:"novalidate"},{default:m(()=>[o("div",q,[o("div",K,[p(t,{name:"username",rules:[{required:!0,message:"Please input your username!"}]},{default:m(()=>[p(d,{placeholder:"Email của bạn",class:"form-input country-phone-input valid",value:a.formState.username,"onUpdate:value":i[0]||(i[0]=s=>a.formState.username=s)},{prefix:m(()=>[]),_:1},8,["value"])]),_:1}),L]),o("div",O,[p(t,{name:"password",autocomplete:"off",rules:[{required:!0,message:"Please input your password!"}]},{default:m(()=>[p(n,{class:"password-login",id:"password",name:"password",placeholder:"Mật khẩu của bạn",type:"password",autocomplete:"current-password",value:a.formState.password,"onUpdate:value":i[1]||(i[1]=s=>a.formState.password=s)},null,8,["value"])]),_:1}),Z])]),j,D,J,Q]),_:1},8,["model","onFinish","onFinishFailed"])])])])}const eo=R(U,[["render",X],["__scopeId","data-v-01c9a458"]]);export{eo as default};
