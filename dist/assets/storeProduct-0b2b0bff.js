import{d as E,a as f,q as O,U as F,s as G,r as J,t as W,x as l,y as c,W as A,F as o,Q as K,V as S,C as d,b as n,I as b,z as _,M as u,G as L,E as z,X as Y,N as q,J as j,K as H}from"./index-cdcf547c.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";const Z=E({setup(){const e=f(O().user.roleClaimDetail);F();const p=G(),I="http://localhost:9000",P=JSON.parse(localStorage.getItem("token")),R=JSON.parse(localStorage.getItem("auth")).role,C=f(p.params.id),$=f([]),i=f(""),a=J({currentPage:1,pageSize:10,totalItems:0,totalPages:0}),y=f(!1),g=f(""),w=f(),D=[{title:"#",key:"index"},{title:"Tên sản phẩm",dataIndex:"producName",key:"producName"},{title:"Ảnh sản phẩm",dataIndex:"imageSp",key:"imageSp"},{title:"Số lượng",dataIndex:"quantity",key:"quantity"},{title:"Giá",key:"price"},{title:"Trạng thái",key:"status"},{title:"Tác vụ",key:R,fixed:"right"}],V=t=>{w.value=t,y.value=!0},B=()=>{console.log(w.value),console.log(g.value),g.value?(M(w.value,g.value),y.value=!1,g.value=""):console.error("Lý do không được để trống")},m=(t,s,h="")=>{K.get(`${I}/api/v1/management/${C.value}/product/view`,{headers:{Authorization:`Bearer ${P}`},params:{page:t,size:s,keyword:h}}).then(k=>{const U=k.data;$.value=U.data,a.totalItems=U.pagination.totalItems,a.totalPages=U.pagination.totalPages}).catch(k=>{console.error(k)})},M=(t,s)=>{const h=new FormData;h.append("productId",t),h.append("banReason",s),K.post(`${I}/api/v1/admin/product/ban`,h,{headers:{Authorization:`Bearer ${P}`}}).then(k=>{S.success("Khóa thành công!"),m(a.currentPage,a.pageSize,i.value)}).catch(k=>{S.error("Khóa không thành công!"),console.error(k)})},X=t=>{const s=new FormData;s.append("productId",t),K.post(`${I}/api/v1/admin/product/open`,s,{headers:{Authorization:`Bearer ${P}`}}).then(h=>{S.success("Mở khóa thành công!"),m(a.currentPage,a.pageSize,i.value)}).catch(h=>{S.error("Mở khóa không thành công!"),console.error(h)})},T=t=>{K.get(`${I}/api/v1/management/${C.value}/product/delete?productId=${t}`,{headers:{Authorization:`Bearer ${P}`}}).then(s=>{S.success("Xóa thành công!"),m(a.currentPage,a.pageSize,i.value)}).catch(s=>{S.error("Xóa không thành công!"),console.error(s)})},r=(t,s)=>{a.currentPage=t,a.pageSize=s,m(t,s,i.value)},v=()=>{a.currentPage=1,m(a.currentPage,a.pageSize,i.value)};return W(()=>{m(a.currentPage,a.pageSize)}),{authStoreClaim:e,users:$,columns:D,pageParam:a,storeId2:C,searchKeyword:i,onChange:r,onSearch:v,confirmRemove:T,role:R,confirmUnBan:X,confirmBan:M,handleBanConfirm:B,showBanModal:V,isBanModalVisible:y,banReason:g}}}),N=e=>(j("data-v-d35a5cdc"),e=e(),H(),e),ee={class:"row mb-3"},te={class:"col-6"},ae={key:0,class:"col-6 d-flex justify-content-end"},oe=N(()=>d("i",{class:"fa-solid fa-plus"},null,-1)),ne={class:"row mb-3"},se={class:"col-12"},re={class:"row"},le={class:"col-12"},ie={key:0},ce={key:1},de=["src","alt"],ue={key:3},pe={key:4},me=N(()=>d("i",{class:"fa-solid fa-pen-to-square"},null,-1)),he=N(()=>d("i",{class:"fa-solid fa-trash-can"},null,-1)),_e=N(()=>d("p",{class:"me-2 text-danger"},"Khóa",-1)),ge=N(()=>d("p",{class:"me-2 text-green"},"Mở",-1)),fe={class:"col-12"};function ye(e,p,I,P,x,R){const C=l("a-breadcrumb-item"),$=l("a-breadcrumb"),i=l("router-link"),a=l("a-button"),y=l("a-input"),g=l("a-form-item"),w=l("a-form"),D=l("a-tag"),V=l("a-space"),B=l("a-popconfirm"),m=l("a-modal"),M=l("a-table"),X=l("a-pagination"),T=l("a-card");return c(),A(T,{style:{width:"100%"}},{default:o(()=>[d("div",ee,[d("div",te,[n($,null,{default:o(()=>[n(C,null,{default:o(()=>[b("Sản phẩm của Cửa hàng")]),_:1})]),_:1})]),e.role==="MANAGER"?(c(),_("div",ae,[n(a,{class:"me-2"},{default:o(()=>[n(i,{to:{name:"product-type/them-moi",params:{id:e.storeId2}}},{default:o(()=>[b(" Loại sản phẩm ")]),_:1},8,["to"])]),_:1}),n(a,{type:"primary",title:"Thêm mới sản phẩm"},{default:o(()=>[n(i,{to:{name:"product/them-moi",params:{id:e.storeId2}}},{default:o(()=>[oe]),_:1},8,["to"])]),_:1})])):u("",!0)]),d("div",ne,[d("div",se,[n(w,{onSubmit:L(e.onSearch,["prevent"])},{default:o(()=>[n(g,null,{default:o(()=>[n(y,{placeholder:"Tìm kiếm sản phẩm",value:e.searchKeyword,"onUpdate:value":p[0]||(p[0]=r=>e.searchKeyword=r),onPressEnter:e.onSearch},null,8,["value","onPressEnter"])]),_:1}),n(a,{type:"primary",onClick:e.onSearch},{default:o(()=>[b("Tìm kiếm")]),_:1},8,["onClick"])]),_:1},8,["onSubmit"])])]),d("div",re,[d("div",le,[n(M,{dataSource:e.users,columns:e.columns,scroll:{x:576},pagination:!1},{bodyCell:o(({column:r,index:v,record:t})=>[r.key==="index"?(c(),_("span",ie,z(v+1),1)):u("",!0),r.key==="producName"?(c(),_("span",ce,z(t.productName),1)):u("",!0),r.key==="imageSp"?(c(),_("img",{key:2,style:{width:"50px !important"},src:t.avatarProduct,alt:t.avatarProduct},null,8,de)):u("",!0),r.key==="quantity"?(c(),_("span",ue,z(t.quantity),1)):u("",!0),r.key==="price"?(c(),_("span",pe,z(t.price),1)):u("",!0),r.key==="status"?(c(),A(D,{key:5,class:Y(t.status?"status-selling":"status-stopped")},{default:o(()=>[b(z(t.status?"Đang bán":"Ngừng bán"),1)]),_:2},1032,["class"])):u("",!0),r.key==="MANAGER"&&e.authStoreClaim!==null?(c(),_(q,{key:6},[n(V,{warp:""},{default:o(()=>[n(i,{to:{name:"admin-product-edit",params:{id:t.productId}}},{default:o(()=>[n(a,{type:"dashed",class:"me-2 text-primary",size:"small",title:"Sửa"},{default:o(()=>[me]),_:1})]),_:2},1032,["to"])]),_:2},1024),n(i,{to:{name:"admin-chi-tiet-san-pham",params:{id:t.productId}}},{default:o(()=>[n(a,{title:"Xem chi tiết",type:"dashed",size:"small",shape:"",class:"me-2 text-warning"},{default:o(()=>[b("Xem ")]),_:1})]),_:2},1032,["to"]),n(B,{title:"Dữ liệu sẽ không thể phục hồi, bạn muốn xóa bản ghi này?","ok-text":"Yes","cancel-text":"No",onConfirm:s=>e.confirmRemove(t.productId)},{default:o(()=>[n(a,{title:"Xóa",type:"dashed",size:"small",shape:"",danger:""},{default:o(()=>[he]),_:1})]),_:2},1032,["onConfirm"])],64)):u("",!0),r.key==="ADMIN"&&e.authStoreClaim!==null?(c(),_(q,{key:7},[n(i,{to:{name:"admin-chi-tiet-san-pham",params:{id:t.productId}}},{default:o(()=>[n(a,{title:"Xem chi tiết",type:"dashed",size:"small",shape:"",class:"me-2 text-warning"},{default:o(()=>[b("Xem ")]),_:1})]),_:2},1032,["to"]),t.status!=2?(c(),A(a,{key:0,onClick:s=>e.showBanModal(t.productId),title:"Khóa sản phẩm",type:"dashed",size:"small",shape:"",danger:""},{default:o(()=>[_e]),_:2},1032,["onClick"])):u("",!0),t.status===2?(c(),A(B,{key:1,title:"Bạn có muốn mở khóa sản phẩm?","ok-text":"Yes","cancel-text":"No",onConfirm:s=>e.confirmUnBan(t.productId)},{default:o(()=>[n(a,{title:"Khóa sản phẩm",type:"dashed",size:"small",shape:""},{default:o(()=>[ge]),_:1})]),_:2},1032,["onConfirm"])):u("",!0),n(m,{visible:e.isBanModalVisible,"onUpdate:visible":p[2]||(p[2]=s=>e.isBanModalVisible=s),title:"Nhập lý do khóa sản phẩm","ok-text":"Khóa","cancel-text":"Hủy",onOk:e.handleBanConfirm},{default:o(()=>[n(y,{value:e.banReason,"onUpdate:value":p[1]||(p[1]=s=>e.banReason=s),placeholder:"Nhập lý do"},null,8,["value"])]),_:1},8,["visible","onOk"])],64)):u("",!0)]),_:1},8,["dataSource","columns"]),d("div",fe,[n(X,{onChange:e.onChange,current:e.pageParam.currentPage,"onUpdate:current":p[3]||(p[3]=r=>e.pageParam.currentPage=r),total:e.pageParam.totalItems,pageSize:e.pageParam.pageSize,"show-total":(r,v)=>`${v[0]}-${v[1]} của ${r} sản phẩm`,class:"mt-2 text-end"},null,8,["onChange","current","total","pageSize","show-total"])])])])]),_:1})}const Se=Q(Z,[["render",ye],["__scopeId","data-v-d35a5cdc"]]);export{Se as default};
