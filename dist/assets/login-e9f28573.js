import{d as v,q as w,r as _,t as b,Q as g,c as k,V as y,x as p,y as S,z as x,C as o,b as c,F as h,O as F,J as A,K as I}from"./index-cdcf547c.js";import{_ as P}from"./_plugin-vue_export-helper-c27b6911.js";const z=v({setup(){const a="http://localhost:9000";w();const n=_({username:"",password:""});b(()=>{localStorage.clear();const s=new URLSearchParams(window.location.search).get("token");if(s){localStorage.setItem("token",JSON.stringify(s));const t=encodeURIComponent(s);g.get(`http://localhost:9000/api/v1/auth/validtoken?token=${t}`).then(r=>{r.data?g.get(`http://localhost:9000/api/v1/auth/getUserFromToken?token=${t}`).then(i=>{console.log(i),localStorage.setItem("auth",JSON.stringify(i.data)),window.location.href="/trang-chu-stores"}).catch(i=>{console.error("Error fetching user data:",i),d("Thất bại!","Không thể lấy thông tin người dùng."),localStorage.clear(),window.location.href="/login"}):(localStorage.clear(),window.location.href="/login")})}});const m=async s=>{const{username:t,password:r}=s,i={email:t,password:r};try{const e=await g.post(`${a}/api/v1/auth/authenticate`,i);console.log(e.data),localStorage.setItem("auth",JSON.stringify(e.data)),localStorage.setItem("token",JSON.stringify(e.data.accesstoken)),e.data.role=="USER"?window.location.href="/trang-chu-stores":e.data.role=="MANAGER"?e.data.storeId==0?window.location.href="/store/info-them-moi":window.location.href="/doanh-thu-store/"+e.data.storeId:e.data.role=="SHIPPER"?window.location.href="/danh-sach-don":e.data.role=="ADMIN"&&(window.location.href="/danh-sach-store")}catch(e){console.log(e),e.response&&e.response.status!==200?(d("Thất bại!","Tài khoản hoặc mật khẩu không đúng!"),console.log(e.response)):d("Thất bại!","Đăng nhập không thành công!")}},f=s=>{console.log("Failed:",s)},u=k(()=>!(n.username&&n.password)),d=(s,t)=>{y.error({content:t,duration:2})};return{formState:n,onFinishFailed:f,onFinish:m,disabled:u}}}),l=a=>(A("data-v-80e63ff8"),a=a(),I(),a),N={class:"login-style sapo-sso"},M={class:"container form form-login"},H=F('<div class="login-form-view" data-v-80e63ff8><div class="header" data-v-80e63ff8><div class="header-image" data-v-80e63ff8><img class="fade show sapo-logo" alt="Sapo" src="https://res.cloudinary.com/dqvr7kat6/image/upload/v1718268402/zu43thyvdywlzfuhxfm6.webp" data-v-80e63ff8></div><div class="title mt-3" data-v-80e63ff8><h1 class="title-center h4" data-v-80e63ff8>Đăng nhập tài khoản</h1></div></div></div>',1),E={class:"login-form-view login-form-block"},T={class:"form-login-info"},U={class:"form-group position-relative",id:"username-input-wrapper"},V=l(()=>o("div",{class:"has-error padding-md-left padding-sm-top"},[o("span",{class:"help-block"},[o("label",{for:"username",class:"help-block field-validation-valid"})])],-1)),C={class:"form-group",id:"password-input-wrapper"},$=l(()=>o("div",{class:"has-error padding-md-left padding-sm-top"},[o("span",{class:"help-block"},[o("label",{for:"password",class:"help-block field-validation-valid"})])],-1)),q=l(()=>o("div",{class:"form-group row margin-sm-bottom d-flex"},[o("div",{class:"col-4"},[o("a",{href:"/register",onclick:"onForgotPassword()",class:"forgot-pos-password"},"Đăng kí tài khoản mới")]),o("div",{class:"col-8"},[o("a",{href:"/forgetPassword",onclick:"onForgotPassword()",class:"forgot-pos-password"},"Quên mật khẩu")])],-1)),L=l(()=>o("div",{class:"mb-3 justify-content-center d-none",id:"g-recaptcha-wrapper"},[o("div",{class:"g-recaptcha","data-sitekey":"6LcyV7InAAAAAK-HaWzFi2P6qGdW0jrspU54bMxo"},[o("div",{style:{width:"304px",height:"78px"}},[o("div",null,[o("iframe",{title:"reCAPTCHA",width:"304",height:"78",role:"presentation",name:"a-fxam4sgkl0fb",frameborder:"0",scrolling:"no",sandbox:"allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox allow-storage-access-by-user-activation",src:"https://www.google.com/recaptcha/api2/anchor?ar=1&k=6LcyV7InAAAAAK-HaWzFi2P6qGdW0jrspU54bMxo&co=aHR0cHM6Ly9hY2NvdW50cy5zYXBvLnZuOjQ0Mw..&hl=vi&v=joHA60MeME-PNviL59xVH9zs&size=normal&cb=u8rsfktzedhv"})]),o("textarea",{id:"g-recaptcha-response",name:"g-recaptcha-response",class:"g-recaptcha-response",style:{width:"250px",height:"40px",border:"1px solid rgb(193, 193, 193)",margin:"10px 25px",padding:"0px",resize:"none",display:"none"}})]),o("iframe",{style:{display:"none"}})])],-1)),O=l(()=>o("div",{class:"text-center mb-3",style:{clear:"both"}},[o("button",{class:"btn-login",type:"submit"},"Đăng nhập")],-1)),R=l(()=>o("div",{class:"social-login mt-3 text-center"},[o("span",{class:"social-login__label"},"Hoặc đăng nhập với"),o("div",{class:"social-login__btn-group mt-3"},[o("a",{href:"http://localhost:9000/oauth2/authorization/google",class:"social-login__item social-login--google",id:"login-with-gg"},[o("img",{src:"https://sapo.dktcdn.net/sso-service/images/svg_sociallogin_gg_new.svg",alt:"sapo",class:"fade show"})])])],-1));function j(a,n,m,f,u,d){const s=p("a-input"),t=p("a-form-item"),r=p("a-input-password"),i=p("a-form");return S(),x("div",N,[o("div",M,[H,o("div",E,[c(i,{model:a.formState,onFinish:a.onFinish,onFinishFailed:a.onFinishFailed,id:"pos-login-form",class:"content mt-4",autocomplete:"off",name:"normal_login",novalidate:"novalidate"},{default:h(()=>[o("div",T,[o("div",U,[c(t,{name:"username",rules:[{required:!0,message:"Please input your username!"}]},{default:h(()=>[c(s,{placeholder:"Email của bạn",class:"form-input country-phone-input valid",value:a.formState.username,"onUpdate:value":n[0]||(n[0]=e=>a.formState.username=e)},{prefix:h(()=>[]),_:1},8,["value"])]),_:1}),V]),o("div",C,[c(t,{name:"password",autocomplete:"off",rules:[{required:!0,message:"Please input your password!"}]},{default:h(()=>[c(r,{class:"password-login",id:"password",name:"password",placeholder:"Mật khẩu của bạn",type:"password",autocomplete:"current-password",value:a.formState.password,"onUpdate:value":n[1]||(n[1]=e=>a.formState.password=e)},null,8,["value"])]),_:1}),$])]),q,L,O,R]),_:1},8,["model","onFinish","onFinishFailed"])])])])}const B=P(z,[["render",j],["__scopeId","data-v-80e63ff8"]]);export{B as default};
